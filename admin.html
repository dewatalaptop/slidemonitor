<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel Slider</title>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        #image-list li { display: flex; justify-content: space-between; align-items: center; background: #fafafa; padding: 5px; margin-bottom: 5px; }
        #image-list li span { word-break: break-all; margin-right: 10px; }
        #image-list li button { background: #dc3545; font-size: 12px; padding: 5px 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Admin Panel Slider</h2>
        <div id="loading">Memuat konfigurasi...</div>

        <div id="admin-form" style="display: none;">
            <div class="form-group">
                <h3>Gambar Slide</h3>
                <ul id="image-list">
                    </ul>
                <label for="new-image-url">Tambah URL Gambar Baru:</label>
                <input type="text" id="new-image-url" placeholder="https://example.com/gambar.jpg">
                <button type="button" id="add-image-btn" style="margin-top: 10px;">Tambah Gambar</button>
            </div>

            <div class="form-group">
                <label for="duration">Durasi per Slide (dalam detik):</label>
                <input type="number" id="duration" min="1">
            </div>

            <div class="form-group">
                <label for="transition">Tipe Transisi:</label>
                <select id="transition">
                    <option value="fade">Fade (Menghilang)</option>
                    <option value="slide">Slide (Bergeser)</option>
                </select>
            </div>

            <hr>
            <button id="save-settings-btn">Simpan Perubahan</button>
            <p id="status-message" style="margin-top: 15px;"></p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        // GANTI DENGAN KONFIGURASI FIREBASE ANDA
        const firebaseConfig = {
            apiKey: "...",
            authDomain: "...",
            projectId: "...",
            storageBucket: "...",
            messagingSenderId: "...",
            appId: "..."
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Referensi
        const docRef = db.collection("settings").doc("sliderConfig");
        const loadingEl = document.getElementById('loading');
        const adminFormEl = document.getElementById('admin-form');
        const imageListEl = document.getElementById('image-list');
        const newImageUrlEl = document.getElementById('new-image-url');
        const addImageBtn = document.getElementById('add-image-btn');
        const durationEl = document.getElementById('duration');
        const transitionEl = document.getElementById('transition');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const statusMessageEl = document.getElementById('status-message');

        // Fungsi untuk me-render daftar gambar
        function renderImageList(images) {
            imageListEl.innerHTML = '';
            images.forEach((url, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${url}</span>
                    <button type="button" class="remove-btn" data-index="${index}">Hapus</button>
                `;
                imageListEl.appendChild(li);
            });

            // Tambahkan event listener untuk tombol hapus
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const indexToRemove = parseInt(e.target.dataset.index, 10);
                    const currentImages = getImagesFromDOM();
                    currentImages.splice(indexToRemove, 1);
                    renderImageList(currentImages); // Render ulang list
                });
            });
        }

        // Fungsi untuk mengambil daftar gambar dari DOM
        function getImagesFromDOM() {
            const images = [];
            imageListEl.querySelectorAll('li span').forEach(span => {
                images.push(span.textContent);
            });
            return images;
        }

        // Fungsi untuk memuat data dari Firestore
        async function loadSettings() {
            try {
                const doc = await docRef.get();
                if (doc.exists) {
                    const config = doc.data();
                    durationEl.value = config.duration / 1000; // Ubah ms ke detik
                    transitionEl.value = config.transition;
                    renderImageList(config.images);
                } else {
                    // Jika dokumen belum ada, buat data default
                    const defaultConfig = {
                        images: ["https://via.placeholder.com/1920x1080.png?text=Slide+1"],
                        duration: 5000,
                        transition: "fade"
                    };
                    await docRef.set(defaultConfig);
                    console.log("Dokumen default dibuat.");
                    loadSettings(); // Muat ulang
                }
                loadingEl.style.display = 'none';
                adminFormEl.style.display = 'block';
            } catch (error) {
                console.error("Error memuat data: ", error);
                loadingEl.textContent = "Error memuat data.";
            }
        }

        // Event listener untuk tombol "Tambah Gambar"
        addImageBtn.addEventListener('click', () => {
            const newUrl = newImageUrlEl.value.trim();
            if (newUrl && (newUrl.startsWith('http://') || newUrl.startsWith('https://'))) {
                const currentImages = getImagesFromDOM();
                currentImages.push(newUrl);
                renderImageList(currentImages);
                newImageUrlEl.value = ''; // Kosongkan input
            } else {
                alert("Masukkan URL gambar yang valid (dimulai dengan http:// atau https://)");
            }
        });

        // Event listener untuk tombol "Simpan Perubahan"
        saveSettingsBtn.addEventListener('click', async () => {
            try {
                statusMessageEl.textContent = 'Menyimpan...';
                
                const newConfig = {
                    images: getImagesFromDOM(),
                    duration: parseInt(durationEl.value, 10) * 1000, // Ubah detik ke ms
                    transition: transitionEl.value
                };

                await docRef.set(newConfig); // 'set' akan menimpa seluruh dokumen
                
                statusMessageEl.textContent = 'Perubahan berhasil disimpan! Tampilan akan update otomatis.';
                setTimeout(() => { statusMessageEl.textContent = ''; }, 3000);

            } catch (error) {
                console.error("Error menyimpan data: ", error);
                statusMessageEl.textContent = 'Gagal menyimpan data.';
            }
        });

        // Muat pengaturan saat halaman admin dibuka
        loadSettings();
    </script>
</body>
</html>
