<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tampilan Slide</title>
    
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            cursor: pointer; 
        }

        #slider-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .slide {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            
            /* Menggunakan 'contain' agar seluruh gambar pas di layar */
            background-size: contain; 
            background-position: center center;
            background-repeat: no-repeat;

            opacity: 0;
            visibility: hidden;
            transition: all 1s ease-in-out;
        }

        /* Transisi FADE */
        .slide.transition-fade.active {
            opacity: 1;
            visibility: visible;
        }

        /* Transisi SLIDE */
        .slide.transition-slide {
            transform: translateX(100%);
        }
        .slide.transition-slide.active {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }
        .slide.transition-slide.exiting {
            transform: translateX(-100%);
        }
    </style>
</head>
<body>
    <div id="slider-container">
        </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        // GANTI DENGAN KONFIGURASI FIREBASE ANDA
        const firebaseConfig = {
            apiKey: "...",
            authDomain: "...",
            projectId: "...",
            storageBucket: "...",
            messagingSenderId: "...",
            appId: "..."
        };

        // Inisialisasi Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            // Referensi
            const sliderContainer = document.getElementById('slider-container');
            const docRef = db.collection("settings").doc("sliderConfig");

            let currentSlideIndex = 0;
            let slideInterval;
            let globalConfig = {};

            // Fungsi untuk memulai/mereset slider
            function startSlider(config) {
                globalConfig = config;
                currentSlideIndex = 0;
                
                if (slideInterval) {
                    clearInterval(slideInterval);
                }
                
                sliderContainer.innerHTML = '';
                
                // Pastikan ada gambar sebelum mencoba memuat
                if (!config.images || config.images.length === 0) {
                    console.warn("Tidak ada gambar ditemukan di konfigurasi.");
                    sliderContainer.innerHTML = '<h1 style="color:white;text-align:center;padding-top:20px;">Tidak ada gambar di panel admin.</h1>';
                    return; // Berhenti di sini jika tidak ada gambar
                }
                
                config.images.forEach((imgUrl, index) => {
                    const slideEl = document.createElement('div');
                    slideEl.classList.add('slide');
                    slideEl.style.backgroundImage = `url(${imgUrl})`;
                    sliderContainer.appendChild(slideEl);
                });

                showSlide(currentSlideIndex);
                slideInterval = setInterval(nextSlide, config.duration);
            }

            // Fungsi untuk menampilkan slide
            function showSlide(index) {
                const slides = document.querySelectorAll('.slide');
                if (!slides.length) return;

                slides.forEach((slide, i) => {
                    slide.classList.remove('active', 'exiting', 'transition-fade', 'transition-slide');
                    slide.classList.add(`transition-${globalConfig.transition || 'fade'}`);

                    if (i === index) {
                        slide.classList.add('active');
                    } else if (i === (index === 0 ? slides.length - 1 : index - 1) && globalConfig.transition === 'slide') {
                        slide.classList.add('exiting');
                    }
                });
            }

            // Fungsi untuk ke slide berikutnya
            function nextSlide() {
                const slides = document.querySelectorAll('.slide');
                if (!slides.length) return;

                currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                showSlide(currentSlideIndex);
            }

            // --- Logika Fullscreen yang Diperbaiki ---
            function requestFullScreen() {
                try {
                    const elem = document.documentElement;
                    if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                    } else if (elem.mozRequestFullScreen) { // Firefox
                        elem.mozRequestFullScreen();
                    } else if (elem.webkitRequestFullscreen) { // Chrome, Safari, Opera
                        elem.webkitRequestFullscreen();
                    } else if (elem.msRequestFullscreen) { // IE/Edge
                        elem.msRequestFullscreen();
                    }
                } catch (e) {
                    console.error("Gagal masuk fullscreen:", e);
                }
            }

            // Coba masuk fullscreen pada klik pertama
            function firstClickGoFullscreen() {
                console.log("Mencoba masuk fullscreen...");
                requestFullScreen();
                // Hapus listener ini setelah dijalankan sekali agar tidak mengganggu
                document.removeEventListener('click', firstClickGoFullscreen);
                document.removeEventListener('touchend', firstClickGoFullscreen);
            }

            document.addEventListener('click', firstClickGoFullscreen);
            document.addEventListener('touchend', firstClickGoFullscreen);
            // --- Akhir Logika Fullscreen ---


            // Listener REAL-TIME dari Firestore (dijalankan terpisah)
            docRef.onSnapshot(
                (doc) => {
                    if (doc.exists && doc.data()) {
                        console.log("Data konfigurasi diterima:", doc.data());
                        startSlider(doc.data());
                    } else {
                        console.log("Dokumen 'sliderConfig' tidak ditemukan atau kosong.");
                        sliderContainer.innerHTML = '<h1 style="color:white;text-align:center;padding-top:20px;">Konfigurasi tidak ditemukan. Buka halaman admin.</h1>';
                    }
                },
                (error) => {
                    console.error("Error mengambil data:", error);
                    sliderContainer.innerHTML = '<h1 style="color:white;text-align:center;padding-top:20px;">Error koneksi ke database. Cek Firebase Rules.</h1>';
                }
            );

        } catch (e) {
            // Tangkap error besar, seperti Firebase gagal inisialisasi
            console.error("Error kritis saat inisialisasi:", e);
            document.body.innerHTML = `<h1 style="color:white;text-align:center;padding-top:20px;">Error Kritis. Cek firebaseConfig Anda.</h1>`;
        }
    </script>
</body>
</html>
